let nowData=null;function getBoard(a,t=1){$("#cardList").html(" "),$("#cardList").hide(),$.ajax({type:"GET",url:`/api/board/${a}/list?page=`+t,contentType:"application/json",dataType:"json"}).done(async function(a,t,e){a.boards.reverse(),await showBoardList(a.boards),nowData=a,$("#cardList").show(),1==a.pageNumber?$("#paginationBack").addClass("disabled"):$("#paginationBack").removeClass("disabled"),a.pageNumber==a.maxPage?$("#paginationNext").addClass("disabled"):$("#paginationNext").removeClass("disabled"),$("#paginationInfo").text(`　${a.pageNumber} / ${a.maxPage}　`)}).fail(function(a,t,e){$("#errorMsg").text(a.responseJSON.msg)})}let removeClassId,removeBoardId;async function removeBoard(){$.ajax({type:"POST",url:`/api/admin/${removeClassId}/removeBoard/`+removeBoardId,contentType:"application/json",dataType:"json"}).done(async function(a,t,e){bootstrap.showToast({body:"削除しました。",toastClass:"text-bg-primary"}),$("#board_"+removeBoardId).remove()}).fail(function(a,t,e){$("#errorMsg").text(a.responseJSON.msg)})}async function showRemoveModal(a,t,e,o,n){removeClassId=a,removeBoardId=t,$("#modalAuthor").text(o),$("#modalTitle").text(e),$("#modalId").text(t),$("#modalContent").text(n),$("#deleteCheckModal").modal("show")}async function showBoardList(a){let t="";t+=`<table class="table">
    <thead>
        <tr>
            <th scope="col">投稿者名</th>
            <th scope="col">タイトル</th>
            <th scope="col">内容</th>
            <th scope="col">ファイル数</th>
            <th scope="col">コメント数</th>
            <th scope="col">日付</th>
            <th scope="col">操作</th>
        </tr>
    </thead>
  <tbody>`;var e=Object.keys(a).reverse();for(const n in e){var o=a[e[n]];t+=`
        <tr id="board_${o._id}">
                <td>${escapeHTML(o.author)}</td>
                <td>${escapeHTML(o.data.title||"タイトル無し")}</td>
                <td>${escapeHTML(truncateString(o.data.content,30)||"")}</td>
                <td>${o.data.files.length}</td>
                <td>${o.lastComment?.commentCount||0}</td>
                <td>${new Date(o.createdAt).toLocaleString("ja")}</td>
                <td>
                    <a target="_blank" href="/class/${o.classId}/board/${o._id}" class="btn btn-info btn-sm">表示</a>
                    <a href="/admin/${o.classId}/comment/${o._id}" class="btn btn-secondary btn-sm">コメント管理</a>
                    <button type="button" target="_blank" onclick="showRemoveModal('${o.classId}', '${o._id}', '${escapeHTML(o.data.title||"タイトル無し")}', '${escapeHTML(o.author)}', '${escapeHTML(truncateString(o.data.content,30)||"")}')" class="btn btn-danger btn-sm">削除</button>
                </td>
        </tr>`}t+="</tbody></table>",$("#cardList").html(t)}$(function(){$("#paginationBack").click(function(a){var t;nowData.pageNumber<=1||(t=nowData.pageNumber-1,getBoard(nowData.classId,t))}),$("#paginationNext").click(function(a){var t;nowData.maxPage<=nowData.pageNumber||(t=nowData.pageNumber+1,getBoard(nowData.classId,t))})});