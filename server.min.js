require("dotenv").config();const express=require("express"),app=express(),log4js=require("log4js"),logger=(log4js.configure({appenders:{default:{type:"file",category:"default",filename:"logs/default.log",pattern:"-yyyy-MM-dd"},express:{type:"file",category:"express",filename:"logs/express.log",pattern:"-yyyy-MM-dd"},system:{type:"console"}},categories:{default:{appenders:["default","system"],level:"ALL"},express:{appenders:["express","system"],level:"ALL"}}}),log4js.getLogger("default")),{MongoClient,Collection}=(logger.level="ALL",require("mongodb")),cookieParser=require("cookie-parser"),expressWs=require("express-ws"),server=(expressWs(app),app.use(express.urlencoded({extended:!0})),app.use(cookieParser()),app.use(log4js.connectLogger(log4js.getLogger("express"),{})),app.set("view engine","ejs"),app.listen(3e3,function(){logger.info("Expressで起動しました。 ポート番号: "+server.address().port)}));async function connectDB(){try{var e=await(await MongoClient.connect(process.env.MongoDB,{useNewUrlParser:!0,useUnifiedTopology:!0,auth:{username:process.env.MongoDB_User,password:process.env.MongoDB_Pass}})).db("dQuestion");app.locals.db=e}catch(e){console.log(e)}}app.use("/",require("./views/views")),connectDB(),app.locals.logger=logger,app.use("/api",require("./routes/api")),app.use(express.static("public")),app.use("/uploads",require("./routes/utils/image404")),app.locals.wsList={},app.use("/ws",require("./routes/websocket/wsConnect"));